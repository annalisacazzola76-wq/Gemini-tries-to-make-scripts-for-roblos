-- Services
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TextChatService = game:GetService("TextChatService")

local LocalPlayer = Players.LocalPlayer

-- Cleanup
if CoreGui:FindFirstChild("ChatBypassGUI") then
    CoreGui.ChatBypassGUI:Destroy()
end

-- GUI Setup
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ChatBypassGUI"
ScreenGui.ResetOnSpawn = false
pcall(function() ScreenGui.Parent = CoreGui end)
if not ScreenGui.Parent then ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui") end

-- Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 280, 0, 180)
MainFrame.Position = UDim2.new(0.5, -140, 0.4, -90)
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
MainFrame.Active = true
MainFrame.Parent = ScreenGui

local MainCorner = Instance.new("UICorner", MainFrame)
MainCorner.CornerRadius = UDim.new(0, 12)

local MainStroke = Instance.new("UIStroke", MainFrame)
MainStroke.Color = Color3.fromRGB(255, 0, 100) -- Colore Magenta/Neon
MainStroke.Thickness = 2

-- Title
local Title = Instance.new("TextLabel", MainFrame)
Title.Size = UDim2.new(1, 0, 0, 40)
Title.Text = "CHAT FILTER BYPASS"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.BackgroundTransparency = 1
Title.TextSize = 16

-- TextBox
local ChatInput = Instance.new("TextBox", MainFrame)
ChatInput.Size = UDim2.new(0.85, 0, 0, 45)
ChatInput.Position = UDim2.new(0.075, 0, 0.3, 0)
ChatInput.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
ChatInput.Text = ""
ChatInput.PlaceholderText = "Type message to bypass..."
ChatInput.TextColor3 = Color3.fromRGB(255, 255, 255)
ChatInput.Font = Enum.Font.Gotham
ChatInput.TextWrapped = true
Instance.new("UICorner", ChatInput).CornerRadius = UDim.new(0, 8)

-- Send Button
local SendBtn = Instance.new("TextButton", MainFrame)
SendBtn.Size = UDim2.new(0.85, 0, 0, 40)
SendBtn.Position = UDim2.new(0.075, 0, 0.65, 0)
SendBtn.BackgroundColor3 = Color3.fromRGB(255, 0, 100)
SendBtn.Text = "SEND BYPASSED"
SendBtn.Font = Enum.Font.GothamBlack
SendBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
Instance.new("UICorner", SendBtn).CornerRadius = UDim.new(0, 8)

-- Close Button
local CloseBtn = Instance.new("TextButton", MainFrame)
CloseBtn.Size = UDim2.new(0, 30, 0, 30)
CloseBtn.Position = UDim2.new(1, -35, 0, 5)
CloseBtn.BackgroundTransparency = 1
CloseBtn.Text = "×"
CloseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseBtn.TextSize = 25

--- LOGICA DI BYPASS ---

-- Questo metodo sostituisce alcune lettere con versioni simili che il filtro ignora
local function finalBypass(text)
    local replacements = {
        ["a"] = "а", ["e"] = "е", ["i"] = "і", ["o"] = "о", 
        ["u"] = "υ", ["s"] = "ѕ", ["c"] = "с", ["y"] = "у"
    }
    local result = ""
    for i = 1, #text do
        local char = text:sub(i,i):lower()
        if replacements[char] then
            result = result .. replacements[char] .. "‌" -- Aggiunge anche un carattere invisibile
        else
            result = result .. text:sub(i,i) .. "‌"
        end
    end
    return result
end

local function SendChat(msg)
    -- Gestione per entrambi i sistemi di chat di Roblox (Vecchio e Nuovo)
    local sayMessage = ReplicatedStorage:FindFirstChild("DefaultChatSystemChatEvents") and ReplicatedStorage.DefaultChatSystemChatEvents:FindFirstChild("SayMessageRequest")
    
    if sayMessage then
        sayMessage:FireServer(msg, "All")
    elseif TextChatService.ChatVersion == Enum.ChatVersion.TextChatService then
        local channel = TextChatService.TextChannels.RBXGeneral
        channel:SendAsync(msg)
    end
end

SendBtn.MouseButton1Click:Connect(function()
    if ChatInput.Text ~= "" then
        local bypassedMessage = finalBypass(ChatInput.Text)
        SendChat(bypassedMessage)
        ChatInput.Text = "" -- Svuota dopo l'invio
    end
end)

CloseBtn.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)

--- Sistema di Trascinamento Mobile ---
local dragging, dragStart, startPos
MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true; dragStart = input.Position; startPos = MainFrame.Position
    end
end)
UserInputService.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)
UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)
