local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer

if CoreGui:FindFirstChild("AdvancedFlyGUI") then CoreGui.AdvancedFlyGUI:Destroy() end

local ScreenGui = Instance.new("ScreenGui", CoreGui)
ScreenGui.Name = "AdvancedFlyGUI"

local Main = Instance.new("Frame", ScreenGui)
Main.Size = UDim2.new(0, 180, 0, 150)
Main.Position = UDim2.new(0.05, 0, 0.3, 0)
Main.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Main.Active = true
Main.Draggable = true -- Puoi spostarla col dito
Instance.new("UICorner", Main)
Instance.new("UIStroke", Main).Color = Color3.fromRGB(0, 255, 255)

local Toggle = Instance.new("TextButton", Main)
Toggle.Size = UDim2.new(0.9, 0, 0, 40)
Toggle.Position = UDim2.new(0.05, 0, 0.1, 0)
Toggle.Text = "FLY: OFF"
Toggle.Font = Enum.Font.GothamBold
Toggle.TextColor3 = Color3.new(1,1,1)
Toggle.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
Instance.new("UICorner", Toggle)

local SpeedInput = Instance.new("TextBox", Main)
SpeedInput.Size = UDim2.new(0.9, 0, 0, 30)
SpeedInput.Position = UDim2.new(0.05, 0, 0.45, 0)
SpeedInput.PlaceholderText = "Speed (Default 50)"
SpeedInput.Text = "50"
SpeedInput.Font = Enum.Font.Gotham
SpeedInput.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
SpeedInput.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", SpeedInput)

local Info = Instance.new("TextLabel", Main)
Info.Size = UDim2.new(1, 0, 0, 20)
Info.Position = UDim2.new(0, 0, 0.75, 0)
Info.Text = "Use W,A,S,D to Move"
Info.TextColor3 = Color3.new(0.7, 0.7, 0.7)
Info.BackgroundTransparency = 1
Info.TextSize = 12

local flying = false
local flySpeed = 50

Toggle.MouseButton1Click:Connect(function()
    flying = not flying
    Toggle.Text = flying and "FLY: ON" or "FLY: OFF"
    Toggle.BackgroundColor3 = flying and Color3.fromRGB(0, 150, 200) or Color3.fromRGB(50, 50, 50)
    
    local char = LocalPlayer.Character
    if not char then return end
    local hrp = char:WaitForChild("HumanoidRootPart")
    
    if flying then
        flySpeed = tonumber(SpeedInput.Text) or 50
        
        local bv = Instance.new("BodyVelocity")
        bv.Name = "FlyVelocity"
        bv.Parent = hrp
        bv.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
        bv.Velocity = Vector3.new(0, 0, 0)
        
        local bg = Instance.new("BodyGyro")
        bg.Name = "FlyGyro"
        bg.Parent = hrp
        bg.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)
        bg.P = 15000
        
        char.Humanoid.PlatformStand = true
        
        task.spawn(function()
            while flying do
                local cam = workspace.CurrentCamera.CFrame
                local moveDirection = Vector3.new(0, 0, 0)
                
                -- Controlli Movimento
                if UserInputService:IsKeyDown(Enum.KeyCode.W) then moveDirection = moveDirection + cam.LookVector end
                if UserInputService:IsKeyDown(Enum.KeyCode.S) then moveDirection = moveDirection - cam.LookVector end
                if UserInputService:IsKeyDown(Enum.KeyCode.A) then moveDirection = moveDirection - cam.RightVector end
                if UserInputService:IsKeyDown(Enum.KeyCode.D) then moveDirection = moveDirection + cam.RightVector end
                
                -- Applica Velocit√† e Rotazione
                bv.Velocity = moveDirection * (tonumber(SpeedInput.Text) or 50)
                bg.CFrame = cam
                
                -- Noclip per non incastrarsi
                for _, part in pairs(char:GetDescendants()) do
                    if part:IsA("BasePart") then part.CanCollide = false end
                end
                
                RunService.Heartbeat:Wait()
            end
            
            -- Reset quando spegni
            bv:Destroy()
            bg:Destroy()
            char.Humanoid.PlatformStand = false
            for _, part in pairs(char:GetDescendants()) do
                if part:IsA("BasePart") then part.CanCollide = true end
            end
        end)
    end
end)

